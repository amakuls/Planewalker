// Generated by CoffeeScript 1.6.3
(function() {
  var MainLoop, Player, gameCanvas, grafx, isDown, isLeft, isRight, isUp, player, spriteFrames, spritesheet;

  gameCanvas = document.getElementById("game");

  grafx = gameCanvas.getContext('2d');

  Player = (function() {
    function Player() {
      this.width = 0;
      this.height = 0;
      this.Previous_X = 0;
      this.Previous_Y = 0;
      this.Velocity_X = 0;
      this.Velocity_Y = 0;
      this.speed = 2.5;
      this.diagonalSpeed = (Math.sqrt(this.speed * this.speed * 2)) / 2;
    }

    return Player;

  })();

  spriteFrames = {};

  player = new Player();

  spritesheet = new Image();

  $.get("/PCSprite.json", function(data) {
    var spritesheetinfo;
    spritesheetinfo = data;
    spritesheet.src = "Images/PCSprite.png";
    spritesheet.width = spritesheetinfo.meta.w;
    spritesheet.height = spritesheetinfo.meta.h;
    spriteFrames = spritesheetinfo.frames;
    player.sprite = spriteFrames["PCLeft-Idle0001.png"];
    player.height = player.sprite.frame.h;
    player.width = player.sprite.frame.w;
    return $.get("/playerstats", function(data) {
      player.side = parseFloat(data.s);
      player.Y = parseFloat(data.y);
      player.X = parseFloat(data.x);
      return MainLoop();
    });
  });

  isLeft = false;

  isRight = false;

  isUp = false;

  isDown = false;

  window.onkeydown = function(e) {
    if (e.keyCode === 65) {
      isLeft = true;
    }
    if (e.keyCode === 68) {
      isRight = true;
    }
    if (e.keyCode === 87) {
      isUp = true;
    }
    if (e.keyCode === 83) {
      return isDown = true;
    }
  };

  window.onkeyup = function(e) {
    if (e.keyCode === 65) {
      isLeft = false;
    }
    if (e.keyCode === 68) {
      isRight = false;
    }
    if (e.keyCode === 87) {
      isUp = false;
    }
    if (e.keyCode === 83) {
      return isDown = false;
    }
  };

  window.onbeforeunload = function() {
    return $.post("/playerstats", {
      x: player.X,
      y: player.Y,
      s: player.side
    });
  };

  window.onunload = function() {
    return $.post("/playerstats", {
      x: player.X,
      y: player.Y,
      s: player.side
    });
  };

  MainLoop = function() {
    gameCanvas.width = window.innerWidth;
    gameCanvas.height = window.innerHeight;
    if (isUp) {
      player.Velocity_Y = -player.speed;
      player.side = 2;
    }
    if (isDown) {
      player.Velocity_Y = player.speed;
      player.side = 1;
    }
    if (isLeft) {
      player.Velocity_X = -player.speed;
      player.side = 3;
    }
    if (isRight) {
      player.Velocity_X = player.speed;
      player.side = 4;
    }
    if (!isLeft && !isRight) {
      player.Velocity_X = 0;
    }
    if (!isUp && !isDown) {
      player.Velocity_Y = 0;
    }
    if (isUp && (isRight || isLeft)) {
      player.Velocity_Y = -player.diagonalSpeed;
    }
    if (isDown && (isRight || isLeft)) {
      player.Velocity_Y = player.diagonalSpeed;
    }
    if (isLeft && (isUp || isDown)) {
      player.Velocity_X = -player.diagonalSpeed;
    }
    if (isRight && (isUp || isDown)) {
      player.Velocity_X = player.diagonalSpeed;
    }
    if (player.side === 2) {
      spritesheet.srcX = 0;
      spritesheet.srcY = 65;
    }
    if (player.side === 1) {
      spritesheet.srcX = 46;
      spritesheet.srcY = 0;
    }
    if (player.side === 3) {
      spritesheet.srcX = 3;
      spritesheet.srcY = 4;
    }
    if (player.side === 4) {
      spritesheet.srcX = 46;
      spritesheet.srcY = 65;
    }
    player.X += player.Velocity_X;
    player.Y += player.Velocity_Y;
    grafx.clearRect(0, 0, gameCanvas.width, gameCanvas.height);
    grafx.drawImage(spritesheet, player.sprite.frame.x, player.sprite.frame.y, player.width, player.height, player.X, player.Y, player.width, player.height);
    return requestAnimationFrame(MainLoop);
  };

}).call(this);

/*
//@ sourceMappingURL=game.map
*/
